// Generated by CoffeeScript 1.12.0
(function () {
	var WebEditorView;
	var SpacePen = require('space-pen');
	var vxUtils = require('../vx-utils');
	var $ = SpacePen.$;
	module.exports = WebEditorView = (function () {
		function WebEditorView(serializedState) {
			var self, wraper, body, tool_bar, iframe, tool_item1, tool_item2, tool_item3;
			console.log(serializedState);
			wraper = document.createElement("div");
			body = document.createElement("div");
			iframe = document.createElement('iframe');
			tool_bar = document.createElement("div");
			tool_item1 = document.createElement('span');
			tool_item1.className = "tool-items icon icon-file-text";
			tool_item1.textContent = "生成";
			tool_item2 = document.createElement('span');
			tool_item2.className = "tool-items icon icon-file-directory";
			tool_item2.textContent = "预览";
			tool_item3 = document.createElement('span');
			tool_item3.className = "tool-items icon  icon-book";
			tool_item3.textContent = "复制";

			wraper.classList.add("web-view");
			wraper.classList.add("pane-item");
			body.classList.add("web-view-body");
			tool_bar.classList.add("web-view-toolbar");

			tool_bar.appendChild(tool_item1);
			tool_bar.appendChild(tool_item2);
			tool_bar.appendChild(tool_item3);

			body.appendChild(iframe);
			wraper.appendChild(body);
			wraper.appendChild(tool_bar);

			self = this;
			this.element = wraper;
			this.iframe = iframe;
			this.toolbar = tool_bar;
			this.relocate('http://www.ibootstrap.cn/');
			this.iframe.setAttribute('name', 'disable-x-frame-options');
			this.iframe.addEventListener('load', function (event) {
				self.title = this.contentDocument.title;
				return atom.notifications.addSuccess(self.title + " has loaded.");
			});
			this.toolbar.addEventListener('click', function (event) {
				var target = event.target,index;
				index = $(target).index();
				if(index==0){
					var window = self.iframe.contentWindow;
					window.downloadLayoutSrc();
					vxUtils.addLayoutFile(this, window.formatSrc);
				}else if(index==1){

				}else if(index==2){
					var window = self.iframe.contentWindow;
					window.downloadLayoutSrc();
					atom.clipboard.write(window.formatSrc);
				}

			});
		}

		WebEditorView.prototype.relocate = function (source) {
			if (this.iframe.contentWindow) {
				return this.iframe.contentWindow.location.href = source;
			} else {
				return this.iframe.setAttribute('src', source);
			}
		};

		WebEditorView.prototype.getTitle = function () {
			return this.title || 'Web View';
		};

		WebEditorView.prototype.serialize = function () {
			if (this.iframe.contentWindow) {
				return this.iframe.contentWindow.location.href;
			} else {
				return this.iframe.getAttribute('src');
			}
		};

		WebEditorView.prototype.destroy = function () {
			return this.element.remove();
		};

		WebEditorView.prototype.getElement = function () {
			return this.element;
		};
		WebEditorView.prototype.getIframe = function () {
			return this.iframe;
		};
		return WebEditorView;

	})();

}).call(this);
